(window.webpackJsonp=window.webpackJsonp||[]).push([["IrisData"],{Em1F:function(e,t){},QnRU:function(e,t,a){"use strict";a.d(t,"a",(function(){return j})),a.d(t,"c",(function(){return E})),a.d(t,"b",(function(){return N}));var r=a("D57K"),s=a("tMmC"),i=a("a0gC");const n=new class{getAllCampaigns(){return new Promise(e=>Object(r.b)(this,void 0,void 0,(function*(){try{(yield i.a.isUserNurturingApiAvailableToUse())?i.a.getUserNurturingPreferenceSetting("campaigns").then(t=>{t||s.a.logError("PSL: window.chrome.ntpSettingsPrivate.getPref does not have campaigns."),e(t||[])}):(s.a.logError("PSL: Error fetching campaigns due to window.chrome.ntpSettingsPrivate.getPref api not available for this version of EDGE"),e([]))}catch(t){s.a.logError(t),e([])}})))}persistCampaigns(e){return new Promise(t=>Object(r.b)(this,void 0,void 0,(function*(){try{(yield i.a.isUserNurturingApiAvailableToUse())?(yield i.a.saveUserNurturingPreferenceSetting("campaigns",e),s.a.log(`PSL: Number of campaigns persisted: ${e.length||0}.`),t(!0)):s.a.logError("PSL: Error persisting campaigns due to window.chrome.ntpSettingsPrivate.getPref api not available for this version of EDGE")}catch(e){s.a.logError(e)}t(!1)})))}clearPersistentStorage(){return this.persistCampaigns([])}};var o=a("dTwT");const c=new class{constructor(){this.storageKey="irisNewsLocalStorage"}getAllCampaigns(){try{return o.a.getObject(this.storageKey)}catch(e){return s.a.logError(`Exception ${e} occurred retrieving user nurturing campaigns from local storage`),[]}}storeCampaigns(e){try{return o.a.setObject(this.storageKey,e),s.a.log(`Number of campaigns persisted in local storage: ${e.length||0}.`),!0}catch(e){return s.a.logError(`Exception ${e} occurred storing user nurturing campaigns in local storage`),!1}}clearLocalStorage(){return this.storeCampaigns([])}};var u=a("HxRh"),l=a("rvYQ"),h=a("ADRF"),d=a("y+Kz"),g=a("I6Lx"),f=a("ypwz"),m=a("s9+9"),p=a("KRKw"),b=a("tERu"),C=a("ljWX"),S=a("VZ41"),v=a("XgsJ"),y=a("HDSB"),O=a("9J8d"),I=a("gqHb"),P=a("XLvf");const j=new class{constructor(){this.cachedSurfaceMap=new Map,this.millisecondsInADay=864e5,this.timeNow=(new Date).getTime(),this.enabledFeatures=[],this.appType=l.b&&l.b.AppType,this.appType===f.a.EdgeChromium&&this.getConfigDataAsync()}get isEnabled(){return!!this.shouldUseCache()||!(!this.irisDataConfig||!this.irisDataConfig.enableCaching)&&this.isCookieConsentNotRequired()}set IrisDataConfig(e){this.irisDataConfig=e}clearCachedSurfaceMap(){this.isEnabled&&this.cachedSurfaceMap.clear()}populateCachedSurfaceMap(){return Object(r.b)(this,void 0,void 0,(function*(){if(this.isEnabled)try{if(this.purgeCacheWithQsp())return yield this.clearCachedSurfacesFromStorage(),void s.a.log("Cache purged!");this.clearCachedSurfaceMap();let e=[];if(e=l.b.AppType===f.a.EdgeChromium?yield n.getAllCampaigns():c.getAllCampaigns(),!e||0===e.length)return void s.a.log("Bulk read of surfaces from local/persistent storage didn't return a surface.");const{subscribers:t}=this.irisDataConfig,a=[];Object.keys(t).forEach(e=>{t[e].active||a.push(C.b[e])}),e.forEach(e=>{e&&e.placement&&(0===a.length||-1===a.indexOf(e.placement))&&(s.a.log(`Populated ${e.placement} from local/persistent storage.`),this.cachedSurfaceMap.set(e.placement,e),this.highestLastAddedTime=0,e.creatives&&e.creatives.length>0&&e.creatives.forEach(e=>{e&&e.storageInfo&&e.storageInfo.lastAddedTime&&(this.highestLastAddedTime=e.storageInfo.lastAddedTime>=this.highestLastAddedTime?e.storageInfo.lastAddedTime:this.highestLastAddedTime)}))})}catch(e){s.a.logError("Bulk read of surfaces from local/persistent storage threw error: "+e)}}))}getLatestCachedSurface(e,t){if(!e||0===e.length||0===this.cachedSurfaceMap.size)return null;if(!this.cachedSurfaceMap.has(e))return null;const a=this.cachedSurfaceMap.get(e);if(!a||!a.creatives||0===a.creatives.length)return null;if(t!==C.c.MSNAnaheimNewsNTPImages)return a;const r=this.getStorageCachingExpiration();let s=!1;return a.creatives.forEach(e=>{e&&e.storageInfo&&e.storageInfo.lastAddedTime&&this.timeNow-e.storageInfo.lastAddedTime<r&&(s=!0)}),s?a:null}addSurfaceToMap(e){if(!e||!e.placement)return;const t=e.placement,a=new Map;if(this.cachedSurfaceMap.has(t)){this.cachedSurfaceMap.get(t).creatives.forEach(e=>{a.set(e.creativeId,e)})}e.creatives&&e.creatives.forEach(e=>{const t={useCount:0,lastAddedTime:this.timeNow};e.storageInfo=t,a.set(e.creativeId,e)}),e.creatives=[...a.values()],s.a.log(`Adding SurfaceInfo ${t} in storage.`),this.cachedSurfaceMap.set(t,e)}addSurfaceCollectionToStorage(e){return Object(r.b)(this,void 0,void 0,(function*(){e&&e.length>0&&(e.forEach(e=>{e.placement!==C.b[C.c.MSNAnaheimNewsNTPImages]&&e.placement!==C.b[C.c.MSNAnaheimNewsNTPImages+C.a]&&this.addSurfaceToMap(e)}),yield this.persistAllSurfaces())}))}persistAllSurfaces(){return Object(r.b)(this,void 0,void 0,(function*(){if(this.isEnabled){if(l.b.AppType===f.a.EdgeChromium)return void(yield n.persistCampaigns([...this.cachedSurfaceMap.values()]));c.storeCampaigns([...this.cachedSurfaceMap.values()])}}))}clearCachedSurfacesFromStorage(){return Object(r.b)(this,void 0,void 0,(function*(){this.isEnabled&&(this.clearCachedSurfaceMap(),l.b.AppType!==f.a.EdgeChromium?c.clearLocalStorage():yield n.clearPersistentStorage())}))}getCachedSurfaceMap(){return this.cachedSurfaceMap}HaveWeShownASurfaceRecently(){return this.highestLastAddedTime>0&&this.timeNow-this.highestLastAddedTime<this.getTimeBetweenShowingDifferentCreatives()}isUserSeenAllCreativesInSurface(e){if(!e||0===e.length)return!1;if(this.cachedSurfaceMap.has(e)){const t=this.cachedSurfaceMap.get(e);let a=0;if(t&&t.creatives&&t.creatives.length>0)return t.creatives.forEach(e=>{e.storageInfo&&e.storageInfo.useCount&&e.storageInfo.lastAddedTime&&(e.storageInfo.useCount>=this.getReshowingCounterForEachCreative()||this.timeNow-e.storageInfo.lastAddedTime<=this.getTimeBetweenReshowingSameCreative())&&a++}),t.creatives.length===a}return!1}filterCreatives(e){if(!e||!this.shouldUseMaximumCapPerCreative())return e;const t=this.irisDataConfig&&this.irisDataConfig.maximumCapPerCreative||2,a=[];return e.creatives.forEach(e=>{e.storageInfo&&e.storageInfo.useCount<=t&&a.push(e)}),e.creatives=a,e}updateAction(e,t,a){if(e&&t&&this.cachedSurfaceMap.has(e)){const r=this.cachedSurfaceMap.get(e);r&&r.creatives&&r.creatives.forEach(e=>{e.creativeId===t&&e.storageInfo&&(e.storageInfo.irisAction=a)})}}markCreativeAsSeenByUser(e,t){if(e&&t&&this.cachedSurfaceMap.has(e)){const a=this.cachedSurfaceMap.get(e);a&&a.creatives&&a.creatives.forEach(e=>{e&&e.creativeId&&e.creativeId===t&&e.storageInfo&&(e.storageInfo.useCount++,e.storageInfo.lastAddedTime=this.timeNow)})}}hasUserDismissedAllStoredSurfaceCreatives(e){if(!e||0===e.length)return!1;if(this.cachedSurfaceMap.has(e)){const t=this.cachedSurfaceMap.get(e);let a=0;if(t&&t.creatives&&t.creatives.length>0)return t.creatives.forEach(e=>{if(!e.storageInfo||!e.storageInfo.irisAction||e.storageInfo.irisAction!==S.a.Dismiss)return!1;a++}),t.creatives.length===a}return!1}updateCreativeLatestAddedTime(e,t,a){if(!this.cachedSurfaceMap.has(e))return;const r=this.cachedSurfaceMap.get(e);r&&r.creatives&&0!==r.creatives.length&&r.creatives.forEach(e=>{e&&e.creativeId===t&&e.storageInfo&&e.storageInfo.lastAddedTime&&(e.storageInfo.lastAddedTime=a)})}getStorageCachingExpiration(){return(this.irisDataConfig&&this.irisDataConfig.storageCachingExpiration||1)*this.millisecondsInADay}getReshowingCounterForEachCreative(){return this.irisDataConfig&&this.irisDataConfig.frequency||2}getTimeBetweenReshowingSameCreative(){return(this.irisDataConfig&&this.irisDataConfig.frequencyInterval||14)*this.millisecondsInADay}getTimeBetweenShowingDifferentCreatives(){return(this.irisDataConfig&&this.irisDataConfig.frequencyIntervalBetweenCreatives||1)*this.millisecondsInADay}purgeCacheWithQsp(){const e=Object(v.n)();if(e){const t=h.a.getQueryParameterByName("purgeCache",e);if(t&&"true"===t.toLocaleLowerCase())return!0}return!1}shouldUseCache(){const e=Object(v.n)();if(e){const t=h.a.getQueryParameterByName("useCache",e);if(t)return"true"===t.toLocaleLowerCase()}return!1}shouldUseMaximumCapPerCreative(){const e=Object(v.n)();if(e){const t=h.a.getQueryParameterByName("useMaxCapPerCreative",e);if(t)return"true"===t.toLocaleLowerCase()}return!0}isCookieConsentNotRequired(){const e=O.a.getInstance().rootReducer.connector(m.a.SharedState),t=e&&e.getCurrentState();return(t&&t.cookieConsentStatus)===p.b.NotRequired}getConfigDataAsync(){return Object(r.b)(this,void 0,void 0,(function*(){return this.getConfigDataPromise=new Promise(e=>{try{Object(y.a)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.getConfigData?window.chrome.ntpSettingsPrivate.getConfigData(t=>{void 0!==t?(this.profileCreationTimeInMs=t.profileCreationTime,this.enabledFeatures=t.enabledFeatures,e()):(I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.bb),{message:"Config data is undefined"})),e())}):(I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Kb),{message:"Failed to fetch config data from chromium API"})),e())}catch(t){I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Fb),{message:"Exception fetching config data from chromium API",pb:Object.assign(Object.assign({},u.Fb.pb),{customMessage:"Exception: "+t})})),e()}}),this.getConfigDataPromise}))}isBlackoutPeriodOver(){return Object(r.b)(this,void 0,void 0,(function*(){this.appType===f.a.EdgeChromium&&(yield this.getConfigDataPromise);const e=this.irisDataConfig.blackoutPeriodInDays&&this.irisDataConfig.blackoutPeriodInDays*this.millisecondsInADay||7*this.millisecondsInADay;return!!this.profileCreationTimeInMs&&this.timeNow-this.profileCreationTimeInMs>e}))}isNurturingEnabled(){return Object(r.b)(this,void 0,void 0,(function*(){return this.appType===f.a.EdgeChromium&&(yield this.getConfigDataPromise),!!this.enabledFeatures&&this.enabledFeatures.indexOf("msUserNurturing")>=0}))}};function E(){return Object(r.b)(this,void 0,void 0,(function*(){if(yield N())return!1;try{return!1!==o.a.getObject(d.u)}catch(e){return I.a.trackAppErrorEvent(Object.assign(Object.assign({},u.Nb),{message:"Failed to fetch nurturing accepted key from local storage",pb:Object.assign(Object.assign({},u.Nb.pb),{customMessage:`Exception: ${e} occurred while reading key: ${d.u} from local storage.`})})),!1}}))}function N(){return Object(r.b)(this,void 0,void 0,(function*(){yield l.b.AccountInfoPromise;const e=l.b.ResolvedAccountInfo;return Object(P.isNullOrUndefined)(g.b.AadState)?b.b.AAD===(e&&e.account_type):g.b.AadState}))}},RUyI:function(e,t){},dkoE:function(e,t,a){"use strict";a.r(t),a.d(t,"IrisDataConnector",(function(){return D})),a.d(t,"IrisDataReducer",(function(){return k})),a.d(t,"irisImageLocalStorage",(function(){return r.a})),a.d(t,"IrisSurfaceName",(function(){return f.c})),a.d(t,"isAadAccount",(function(){return s.b})),a.d(t,"isNurturingAccepted",(function(){return s.c})),a.d(t,"RegisterErrorTrackingCallback",(function(){return E.a})),a.d(t,"ToolingInfo",(function(){return q}));var r=a("B5Qt"),s=a("QnRU"),i=a("Em1F"),n=a("D57K"),o=a("tMmC"),c=a("HxRh"),u=a("1w6q"),l=a("rvYQ"),h=a("dTwT"),d=a("ax+D"),g=a("ADRF"),f=a("ljWX"),m=a("VZ41"),p=a("SPwp"),b=a("Vvi2"),C=a("ypwz"),S=a("4wjP"),v=a("Ozxe");const y={[C.a.HomePage]:"1",[C.a.Edge+S.b.DHP]:"2",[C.a.EdgeChromium+S.b.DHP]:"2",[C.a.Edge+S.b.NTP]:"3",[C.a.EdgeChromium+S.b.NTP]:"3",[C.a.Windows]:"7",[C.a.WindowsShell]:"7",[C.a.Finance]:"8",[C.a.Hub]:"8",[C.a.Weather]:"8",[C.a.Views]:"9",[C.a.MicrosoftNews]:"11",[C.a.MMX+S.b.Launcher]:"12"},O={[v.a.Edge]:"1",[v.a.Chrome]:"2",[v.a.InternetExplorer]:"3",[v.a.Firefox]:"4",[v.a.Safari]:"5",[v.a.Chromium]:"6",[v.a.EdgeChromium]:"6"};var I=a("I6Lx"),P=a("hOj1"),j=a("pVDi"),E=a("gqHb"),N=a("r6MD"),w=a("XLvf");class A{static runValidation(e,t){switch(e){case f.c.MSNAnaheimNewsNTPImages:case f.c.MSNAnaheimNewsNTPImages+f.a:{const e=!Object(w.isNullOrUndefined)(t)&&t,a=r.a.getStoredImageData(),s=!!Object(w.isNullOrUndefined)(a)||r.a.imageHasTimedOut(a.imgExpiration),i=!Object(w.isNullOrUndefined)(a)&&I.b.Locale;if(!!i&&i===a.reqMarket&&!s&&!e)return;let n;l.b.CurrentRequestTargetScope&&l.b.CurrentRequestTargetScope.pageExperiments&&(n=-1!==l.b.CurrentRequestTargetScope.pageExperiments.indexOf("prg-hsptmtnow-t")?"prg-hsptmtnow-t":-1!==l.b.CurrentRequestTargetScope.pageExperiments.indexOf("prg-hsptinfo-t")?"prg-hsptinfo-t":void 0);let o=null;n&&(o={aflights:n});let c=null;if(e){c={xSdkIaf:r.a.getDislikeList()}}return{addToCall:!0,headers:Object.assign({},c),parameters:Object.assign(Object.assign({},o),{nocookie:"1"})}}case f.c.MSNNewsCoachmark:case f.c.MSNNewsCoachmark+f.a:return{addToCall:!0,parameters:{nocookie:"0"}};case f.c.ConditionalBanner:case f.c.ConditionalBanner+f.a:return{addToCall:!0,parameters:Object.assign({},A.getConditionalBannerIrisCallParameters(e))};case f.c.MSNewsRewards:case f.c.MSNewsRewards+f.a:return{addToCall:!0,parameters:{nocookie:"0"}};default:return void E.a.trackAppErrorEvent(Object.assign(Object.assign({},c.Ke),{message:"Subscriber validation function not found.",pb:Object.assign(Object.assign({},c.Ke.pb),{customMessage:"Subscriber: "+e})}))}}static getConditionalBannerIrisCallParameters(e){const t=new Object;t.nocookie="0";const a=Object(P.a)(I.b.AnonCookieName);t.ISSIGNEDIN=a?"1":"0";const r=Object(N.a)(I.b,"ClientSettings.apptype"),s=Object(N.a)(I.b,"ClientSettings.pagetype"),i=A.mapCanvasId(r,s);i&&(t.MSN_CANVAS=i),r===C.a.Edge&&l.b&&l.b.CurrentRequestTargetScope&&l.b.CurrentRequestTargetScope.os===j.a.Windows&&(t.OPSYS="WIN10");const n=Object(N.a)(I.b,"ClientSettings.browser");if(n){const e=n.ismobile;e&&(t.ISMOBILE="TRUE"===e.toUpperCase()?"1":"0");const a=O[n.browserType];a&&(t.BROWSER=a)}const o=[];return"ISSIGNEDIN"in t||o.push("ISSIGNEDIN"),"MSN_CANVAS"in t||o.push("MSN_CANVAS"),"ISMOBILE"in t||o.push("ISMOBILE"),"BROWSER"in t||o.push("BROWSER"),o.length>0&&E.a.trackAppErrorEvent(Object.assign(Object.assign({},c.dd),{message:"Missing parameters for subscriber",pb:Object.assign(Object.assign({},c.dd.pb),{customMessage:`parameters ${o.toString()} for subscriber ${e}`})})),t}static mapCanvasId(e,t){let a=null;switch(e){case C.a.Edge:case C.a.EdgeChromium:case C.a.MMX:a=[e+t];break;default:a=e}return y[a]}}var M=a("u5KZ"),T=a("XgsJ");class D extends u.a{constructor(e,t,a,r,i,o,c){if(super(e,t,a,r,i,o,c),this.headers=[null],this.queryParameters=[null],this.surfaceInfoMap=new Map,o.disableIrisCalls||!o.subscribers)return void(this.callWasMade=!1);this.irisDataPromise=new Promise(e=>Object(n.b)(this,void 0,void 0,(function*(){s.a.IrisDataConfig=o,this.appType=l.b&&l.b.AppType,this.internalPlacementUsed=Object(f.i)(),this.appType?(this.isBlackoutPeriodOver=this.appType!==C.a.EdgeChromium||(yield s.a.isBlackoutPeriodOver()),this.isBlackoutPeriodOver&&(yield s.a.populateCachedSurfaceMap()),this.internalPlacementUsed===this.shouldUseCacheForInternalPlacements()&&Object.keys(this.config.subscribers).forEach(e=>{const t=this.internalPlacementUsed?e+f.a:e,a=f.b[t],r=s.a.getLatestCachedSurface(a,t);r&&r.placement&&this.surfaceInfoMap.set(a,r)}),yield this.prepareCallData(),!this.queryParameters||Object(w.isNullOrUndefined)(this.queryParameters[0])&&this.queryParameters.length<=1?this.callWasMade=!1:(this.callIris(),this.callWasMade=!0),e()):this.callWasMade=!1}))),this.irisDataPromise;const u=this.config.subscribers;Object.keys(u).forEach(e=>{const t=u[e].captureInitialStateOfCampaigns;if(t)for(const e in t)h.a.getObject(e)&&M.a.addOrUpdateTmplString(`userEligibleToSeeCoachmark_${e}:1`)})}sendActionUpdate(e,t,a,r,i){let n;e&&t&&(a===m.b.Impression?s.a.markCreativeAsSeenByUser(e,t):s.a.updateAction(e,t,i),s.a.persistAllSurfaces()),n=a===m.b.Impression?r.impressionUrl:p.a.formatTelemetryActionUrl(r.actionUrl,i);try{b.a.sendActionUpdate(n)}catch(e){o.a.log("IrisDataConnector: Failed to report iris action update beacon due to error: "+JSON.stringify(e))}}getImagePayload(e){return Object(n.b)(this,void 0,void 0,(function*(){return e&&(yield this.prepareCallData(!0),this.callIris(),this.callWasMade=!0),yield this.getPayload(f.c.MSNAnaheimNewsNTPImages)}))}getPayload(e){return Object(n.b)(this,void 0,void 0,(function*(){let t;yield this.irisDataPromise,this.callWasMade&&(yield this.irisCallPromise);let a=this.shouldUseRequestedIrisSurface();if(a&&(this.internalPlacementUsed&&(a+=f.a),t=f.b[a]),!t){const e=Array.from(this.surfaceInfoMap.keys());let a=0;do{t=e[Math.floor(Math.random()*e.length)]}while(a++<e.length)}const r=e&&this.internalPlacementUsed?e+f.a:e;return r&&t!==f.b[r]?f.c.MSNAnaheimNewsNTPImages===r||f.c.MSNAnaheimNewsNTPImages+f.a===r?(t=f.b[r],yield this.tryGetSurfaceInfo(t)):(o.a.log(`IrisDataConnector: Surface requested ${f.b[r]} by experience is not same as surface ${t} picked.`),null):yield this.tryGetSurfaceInfo(t)}))}tryGetSurfaceInfo(e){return Object(n.b)(this,void 0,void 0,(function*(){if(!this.surfaceInfoMap.has(e))return o.a.log(`IrisDataConnector: Placement: ${e} was not populated by local/persistent storage nor downloaded by network call.`),null;let t=this.surfaceInfoMap.get(e);return f.b[f.c.MSNAnaheimNewsNTPImages]===e||f.b[f.c.MSNAnaheimNewsNTPImages+f.a]===e||this.shouldBlockPsl()?t:(yield Object(s.b)())?(o.a.log(`IrisDataConnector: This is AAD user so not returning SurfaceInfo for: ${e} to experience.`),null):this.isUserNurturedWithOneSurface?(o.a.log(`IrisDataConnector: Already sent surfaceInfo so not returning SurfaceInfo for: ${e} to experience.`),null):s.a.HaveWeShownASurfaceRecently()?(o.a.log(`IrisDataConnector: Already shown a campaign within 24 hours so not returning SurfaceInfo for: ${e} to experience.`),null):s.a.isUserSeenAllCreativesInSurface(e)?(o.a.log(`IrisDataConnector: We have already shown this so not returning SurfaceInfo for: ${e} to experience.`),null):(t=s.a.filterCreatives(t),this.isUserNurturedWithOneSurface=!0,o.a.log(`IrisDataConnector: Returning SurfaceInfo for: ${e} to experience.`),t)}))}prepareCallData(e){return Object(n.b)(this,void 0,void 0,(function*(){const{subscribers:t}=this.config,a=[],r=[],i=[];let n;const o=yield s.a.isNurturingEnabled(),u=yield Object(s.c)();if(Object.keys(t).forEach(s=>{let l;if(!t[s].active)return;const h=this.queryParameters.length,g=this.internalPlacementUsed?s+f.a:s,m=f.b[g];if(!m)return void E.a.trackAppErrorEvent(Object.assign(Object.assign({},c.Le),{message:"Subscriber not found in iris placement dictionary",pb:Object.assign(Object.assign({},c.Le.pb),{customMessage:`Subscriber ${g} not found in dictionary`})}));const p=f.b[f.c.MSNAnaheimNewsNTPImages]===m||f.b[f.c.MSNAnaheimNewsNTPImages+f.a]===m,b=!Object(w.isNullOrUndefined)(e)&&e;if((p||!b)&&(!this.appType||this.appType!==C.a.EdgeChromium||p||u&&o)&&(this.isBlackoutPeriodOver||p)&&(!this.surfaceInfoMap.has(m)||p&&b)){const{creativeCount:o,performValidation:u,staticQueryParams:f,aflights:b}=t[s];if(u&&(l=A.runValidation(g,e),!l||!l.addToCall))return;let C=o||1;if(C=l&&l.parameters&&l.parameters.bcnt?l.parameters.bcnt:C,C<=0)return void E.a.trackAppErrorEvent(Object.assign(Object.assign({},c.lb),{message:"Creative count value is negative or zero",pb:Object.assign(Object.assign({},c.lb.pb),{customMessage:"Creative count value is negative or zero : "+g})}));if(p?(this.queryParameters[h]={placement:m},this.queryParameters[h].bcnt=C):(a.push(m),r.push(C)),d.a.isNotNullOrUndefined(f)&&(p?this.queryParameters[h]=Object.assign(Object.assign({},this.queryParameters[h]),f):n=Object.assign(Object.assign({},n),f)),l&&l.parameters&&d.a.isNotNullOrUndefined(l.parameters)&&(p?this.queryParameters[h]=Object.assign(Object.assign({},this.queryParameters[h]),l.parameters):n=Object.assign(Object.assign({},n),l.parameters)),l&&l.headers&&d.a.isNotNullOrUndefined(l.headers)&&(p?this.headers[h]=Object.assign({},l.headers):this.headers[0]=Object.assign(Object.assign({},this.headers),l.headers)),d.a.isNotNullOrUndefined(b)&&"object"==typeof b)for(const e in b)b[e]&&(p?this.queryParameters[h].aflights=b[e]:i.push(b[e]))}}),d.a.isNotNullOrUndefined(this.config.dynamicQueryParams)){n=Object.assign(Object.assign({},n),this.config.dynamicQueryParams);for(let e=1;e<this.queryParameters.length;e++)this.queryParameters[e]=Object.assign(Object.assign({},this.queryParameters[e]),this.config.dynamicQueryParams)}a.length>0&&(this.queryParameters[0]={placement:a.join("|")},this.queryParameters[0]=Object.assign(Object.assign({},this.queryParameters[0]),n),this.queryParameters[0].bcnt=r.join("|"),this.queryParameters[0].aflights=i.join(";"))}))}callIris(){this.irisCallPromise=new Promise(e=>Object(n.b)(this,void 0,void 0,(function*(){try{for(let e=0;e<this.queryParameters.length;e++){if(Object(w.isNullOrUndefined)(this.queryParameters[e]))continue;this.surfaceCollection=yield b.a.requestSurfaceInfo(this.queryParameters[e],this.headers[e],this.config.irisEndpoint);const t=this.getSurfacesFromCollection();yield s.a.addSurfaceCollectionToStorage(t)}}catch(e){this.callWasMade=!1,M.a.sendAppErrorEvent(Object.assign(Object.assign({},c.Gb),{message:"IrisDataConnector: Exception requesting iris surfaces from data connector.",pb:Object.assign(Object.assign({},c.Gb.pb),{customMessage:`Error: ${JSON.stringify(e)} requestUrl: ${this.config.irisEndpoint} queryParameters: ${JSON.stringify(this.queryParameters)} headers: ${this.headers}`})}))}this.queryParameters=[null],this.headers=[null],e()}))),this.irisCallPromise}getSurfacesFromCollection(){const e=this.config.subscribers;if(!(e&&this.surfaceCollection&&this.surfaceCollection.collection&&this.surfaceCollection.reqContext&&this.surfaceCollection.reqContext.queryParams&&this.surfaceCollection.reqContext.queryParams.placement))return null;const t=[];return Object.keys(e).forEach(a=>{const r=this.getSurfaceFromCollection(a);r&&r.placement&&(o.a.log(`IrisDataConnector: Parsed response for ${r.placement} from Iris network call. Now adding to map.`),t.push(r),this.surfaceInfoMap.set(r.placement,r),this.captureInitialEligibilityStateOfCampaigns(r,e[a].captureInitialStateOfCampaigns))}),t}getSurfaceFromCollection(e){const t=this.internalPlacementUsed?e+f.a:e,a=f.b[t],r=this.surfaceCollection.reqContext.queryParams.placement;let s;if(-1==r.indexOf("|")){if(this.surfaceCollection.collection.hasUnclaimedErrors()){return void this.surfaceCollection.collection.getUnclaimedErrors().forEach(e=>{E.a.trackAppErrorEvent(Object.assign(Object.assign({},c.Cb),{message:"Surface errors discovered",pb:Object.assign(Object.assign({},c.Cb.pb),{customMessage:`Error with surface: ${t} Code: ${e.code} Message: ${e.msg}`})}))})}if(a===r&&this.surfaceCollection.collection.hasUnknowns()){return s=this.surfaceCollection.collection.getUnknowns()[0],s&&!s.placement&&(s.placement=a),s}}return s=this.surfaceCollection.collection.get(a),s&&!s.placement&&(s.placement=a),s}captureInitialEligibilityStateOfCampaigns(e,t){e.creatives&&t&&"object"==typeof t&&e.creatives.forEach(a=>{let r=!1;for(const s in t)if(e.placement===t[s]&&a.creativeId===s){r=!0;break}const s=h.a.getObject(a.creativeId);Object(w.isNullOrUndefined)(s)&&h.a.setObject(a.creativeId,r)})}shouldUseCacheForInternalPlacements(){const e=Object(T.n)();if(e){const t=g.a.getQueryParameterByName("useCacheForInternalPlacements",e);if(t)return"true"===t.toLocaleLowerCase()}return!1}shouldUseRequestedIrisSurface(){const e=Object(T.n)();if(e){const t=g.a.getQueryParameterByName("irisSurface",e);if(t)return t}return null}shouldBlockPsl(){const e=Object(T.n)();if(e){const t=g.a.getQueryParameterByName("blockPsl",e);if(t)return"true"===t.toLocaleLowerCase()}return!1}}class k{reduce(){return null}}var U=a("RUyI");const q={experienceConfigSchema:i.IrisDataConfigSchema,mockConfig:U.mockConfig}}}]);