(window.webpackJsonp=window.webpackJsonp||[]).push([["topicData"],{"2Sqd":function(e,t,i){"use strict";i.r(t),i.d(t,"FollowState",(function(){return s.a})),i.d(t,"ResizeServiceImage",(function(){return d})),i.d(t,"TopicDataActions",(function(){return u.a})),i.d(t,"TopicDataConnector",(function(){return Y})),i.d(t,"TopicDataReducer",(function(){return te})),i.d(t,"TopicsFetchState",(function(){return o.a})),i.d(t,"ToolingInfo",(function(){return ie})),i.d(t,"clearTopicsCache",(function(){return r.a})),i.d(t,"registerTopicsCacheAppErrorCallback",(function(){return r.e}));var s=i("uH2+"),o=i("FRpP"),r=i("6urM"),n=i("ADRF"),a=i("SNCn");var c;!function(e){e[e.LetterBox=1]="LetterBox",e[e.Scale=2]="Scale",e[e.Stretch=3]="Stretch",e[e.Crop=4]="Crop",e[e.FocalCrop=5]="FocalCrop",e[e.TmxResize=6]="TmxResize",e[e.AppExResize=7]="AppExResize",e[e.CustomCrop=8]="CustomCrop"}(c||(c={}));class d{constructor(e,t=0,i=0){this.url=e,this.height=t,this.width=i,this.mode=c.Crop,this.quality=60,this.url=(this.url||"").replace(/http:/,"https:").replace(/\?.*/,"")}static from(e){return e?new d(e.url,e.height,e.width):null}get src(){const e=[];return e.push({key:"w",value:Object(a.a)(this.width)}),e.push({key:"h",value:Object(a.a)(this.height)}),e.push({key:"m",value:Object(a.a)(this.mode)}),e.push({key:"q",value:Object(a.a)(this.quality)}),this.url+"?"+n.a.keyValueArrayToQueryString(e)}resizeTo(e,t){return this.width=t,this.height=e,this}}var l,u=i("FaCY"),p=i("D57K"),h=i("HxRh"),g=i("1w6q"),f=i("I6Lx"),b=i("ax+D"),m=i("dTwT"),y=i("XMd8"),v=i("tERu"),O=i("rPvf"),T=i("8X6I"),w=i("SSDD"),j=i("k112"),S=i("KUTD"),I=i("k3mM"),F=i("XLvf");!function(e){e.SysTag="SysTag",e.UserQuery="UserQuery"}(l||(l={}));var C,R=i("u5KZ"),k=i("C8K2");!function(e){e.topicCardBackupImageUrl="https://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtCmK3.img";e.TopicCardStandardDimensions={borderWidth:4,height:250,width:250,gutterSize:k.a},e.TopicCardImageStandardDimensions={height:242,width:242}}(C||(C={}));const E="feeds";var A=i("y+Kz"),M=i("rvYQ"),U=i("6ADy"),P=i("msIb"),q=i("KETb"),L=i("hxZq"),D=i("hDMs"),x=i("MptA"),Q=i("NuVg"),H=i("tMmC");class N{static TranslateToTopicGroups(e,t){if(H.a.logObjects(e),!b.a.isDefined(e)||!N.isValidCompositeCardResponse(e.value))throw new Error("Topics OneService response schema validation error: no valid topic groups found!");const i={topicGroupIds:[],topicGroupMap:{},topicMap:{}};return e.value[0].subCards.forEach(e=>{if(N.isValidTopicGroup(e,!0)){const s=N.getTopics(e,t);b.a.arrayHasData(s)&&(s.forEach(e=>{i.topicMap[e.id]=e}),i.topicGroupMap[e.id]={id:e.id,nextPageUrl:e.nextPageUrl,title:e.title,topicIds:s.map(e=>e.id)},i.topicGroupIds.push(e.id))}}),i}static TranslateToRecommendedTopics(e){if(H.a.logObjects(e),!b.a.isDefined(e)&&e.value)throw new Error("Topics OneService response schema validation error: no valid topic group found!");return e.value.map(e=>{const t=Object.assign(Object.assign({},e),{name:e.title,feedType:null});return N.getTopic(t,null)})}static TranslateSingleTopicResponseToTopic(e){if(!b.a.isDefined(e)||!N.isValidCompositeCardResponse(e.value))throw new Error("Topics OneService response schema validation error: no valid followed topics found!");const t=e.value[0].subCards;return N.getTopic(t[0],null)}static TranslateToFollowedTopics(e){if(H.a.logObjects(e),!b.a.isDefined(e)||!b.a.arrayHasData(e.value))throw new Error("Topics OneService response schema validation error: no valid followed topics found!");const t=e.value,i={};return t.forEach(e=>{if(e&&e.id){const t={};t[e.id]=[{followState:"followed"}],e.title&&(e.name=e.title,delete e.title);const s=N.getTopic(e,t);i[s.id]=s}}),i}static getTopic(e,t,i){if(!Object(x.a)(e.id)||!Object(x.a)(e.name))return null;let o;if(o=t&&b.a.arrayHasData(t[e.id])?t[e.id][0]:{followState:s.a.Unfollowed},!b.a.isDefined(o))return null;i||(i=C.TopicCardImageStandardDimensions);const r=e.image,n=r&&r.url?d.from(r).resizeTo(i.height,i.width).src:C.topicCardBackupImageUrl;return{id:e.id,name:e.name,followState:o.followState===s.a.Unfollowed||o.followState===s.a.None?s.a.Unfollowed:s.a.Followed,imgSrc:n,href:D.a.generateTopicLink(e.id,e.name),feedType:e.feedType,canonicalName:e.canonicalName,isInferred:e.isInferred,branding:e.branding}}static getTopics(e,t){const i=[];return e.subCards.forEach(s=>{const o=N.getTopic(s,e.metadata,t);i.push(o)}),i}static isValidTopicGroup(e,t){return(!t||Object(x.a)(e.id))&&!Object(Q.a)(e.metadata)&&b.a.arrayHasData(e.subCards)}static isValidCompositeCardResponse(e){return b.a.arrayHasData(e)&&b.a.arrayHasData(e[0].subCards)}}var G=i("/+Un"),$=i("YI90"),K=i("fuIx"),V=i("e8jz"),z=i("CzGr"),B=i("Zsg4");class W{constructor(e){this.fetchImpl=e}getFollowedTopics(e,t){return Object(p.b)(this,void 0,void 0,(function*(){const i=yield this.getRequestInit(),s=yield this.getCommonParams(E),o=Object(K.b)()?null:Object(L.b)(),r=[...s,{key:A.w.queryType,value:"MyFeed"},{key:A.w.top,value:"1000"},{key:"allTopics",value:"true"},{key:"rndId",value:e?Object($.a)(0,1e3).toString():null},{key:L.a,value:o?o.toString():null},{key:A.w.responseSchema,value:"cardView"}];t&&r.push({key:"$orderby",value:"createdDateTime desc"});const n=this.getLocationData();n&&!Object(K.b)()&&r.push({key:A.w.location,value:n});const a=Object(U.d)("msn/topics");this.appendQs(r,a);const c=yield this.sendRequest(decodeURIComponent(a.href),i,"getUserTopics");return N.TranslateToFollowedTopics(c)}))}getRecommendedTopics(){return Object(p.b)(this,void 0,void 0,(function*(){const e=yield this.getRequestInit(),t=[...yield this.getCommonParams(E),{key:A.w.queryType,value:"recommendations"},{key:A.w.select,value:"id,title,image"}],i=Object(U.d)("msn/topics/me/recommendations");this.appendQs(t,i);const s=yield this.sendRequest(decodeURIComponent(i.href),e,"getRecommendedTopics");return N.TranslateToRecommendedTopics(s)}))}getRelatedTopics(e,t){return Object(p.b)(this,void 0,void 0,(function*(){const i=Object(U.d)("news/topics/{id}/related".replace("{id}",e)),s=yield this.getCommonParams(E);t&&t>0&&s.push({key:A.w.top,value:t.toString()}),this.appendQs(s,i);const o=yield this.getRequestInit(),r=yield this.sendRequest(decodeURIComponent(i.href),o,"getRelatedTopics");return r&&0===r.length?r:N.TranslateToRecommendedTopics(r)}))}getTopics(e,t){return Object(p.b)(this,void 0,void 0,(function*(){const i=yield this.getRequestInit(),s=yield this.getCommonParams(E),o=t||[...s,{key:A.w.queryType,value:"Discover"},{key:A.w.top,value:"100"},{key:A.w.select,value:"id,name,image,feedType,canonicalName,branding"}],r=this.getLocationData();r&&o.push({key:A.w.location,value:r});const n=Object(U.d)("msn/topics");this.appendQs(o,n);const a=yield this.sendRequest(decodeURIComponent(n.href),i,"getTopicGroups");return N.TranslateToTopicGroups(a,e)}))}getTopic(e){return Object(p.b)(this,void 0,void 0,(function*(){const t=yield this.getRequestInit(),i=[...yield this.getCommonParams(E),{key:A.w.ids,value:e}],s=this.getLocationData();s&&i.push({key:A.w.location,value:s});const o=Object(U.d)("msn/topics");this.appendQs(i,o);const r=yield this.sendRequest(decodeURIComponent(o.href),t,"getTopic");return N.TranslateSingleTopicResponseToTopic(r)}))}updateTopicFollowingState(e,t,i){return Object(p.b)(this,void 0,void 0,(function*(){const s=Object(U.d)("Graph/Actions"),o=yield this.getRequestInit(),r=yield this.getCommonParams(E),n=this.getLocationData();if(n&&r.push({key:A.w.location,value:n}),t){const t={actionType:"Follow"};e?t.targetId=e:i&&(t.definitionName=i),o.method="POST",o.headers["Content-Type"]="text/json",o.body=JSON.stringify(t),this.appendQs(r,s)}else{const t={key:A.w.filter,value:`actionType eq 'Follow' and (targetId eq '${e}')`};o.method="DELETE";const i=[t,...r];this.appendQs(i,s)}return yield this.sendRequest(decodeURIComponent(s.href),o,"updateTopicFollowingState")}))}restoreDefaultTopics(){return Object(p.b)(this,void 0,void 0,(function*(){const e=Object(U.d)("Graph/Actions"),t=yield this.getRequestInit();t.method="DELETE";const i=[...yield this.getCommonParams(E),{key:A.w.filter,value:"actionType eq 'Follow'"}];this.appendQs(i,e);return yield this.sendRequest(decodeURIComponent(e.href),t,"restoreDefaultTopics")}))}getLocationData(){const e=Object(f.a)();return e.ClientSettings&&e.ClientSettings.geo_lat&&e.ClientSettings.geo_long?`${e.ClientSettings.geo_lat}|${e.ClientSettings.geo_long}`:null}getCommonParams(e){return Object(p.b)(this,void 0,void 0,(function*(){if(Object(K.b)())return this.getSapphireQueryParams();return(yield this.isUserSignedIn())?P.a.getOneServiceParamsWithAuth(M.b.UserId,e):P.a.getOneServiceParamsWithoutAuth(M.b.UserId,e)}))}getSapphireQueryParams(){const e=P.a.getOneServiceNonDynamicParamsWithoutAuth(E),t=Object(V.b)();return t&&(e.push({key:A.w.market,value:t.market}),e.push({key:A.w.fdhead,value:t.features}),e.push({key:A.w.activityId,value:t.activityId}),t.latitude&&t.longitude&&e.push({key:A.w.location,value:`${t.latitude}|${t.longitude}`})),e}getRequestInit(e=null){return Object(p.b)(this,void 0,void 0,(function*(){return null==e&&(e={method:"GET"}),(yield this.isUserSignedIn())&&(e.credentials="include"),e.headers=Object(K.b)()?yield Object(z.a)():yield P.a.getOneServiceHeaders(),e}))}isUserSignedIn(){return Object(p.b)(this,void 0,void 0,(function*(){const e=Object(f.a)().UserIsSignedIn;if(void 0!==e)return e;return(yield Object(G.c)())===v.c.SignedIn}))}sendRequest(e,t,i){return Object(p.b)(this,void 0,void 0,(function*(){return Object(K.b)()?yield this.sapphireRequest(decodeURIComponent(e),t):yield this.networkRequest(decodeURIComponent(e),t,i)}))}sapphireRequest(e,t){return Object(p.b)(this,void 0,void 0,(function*(){const i={url:e,headers:t.headers,body:t.body,refresh:!0};let s;switch(t.method){case"POST":s=yield Object(B.i)(i);break;case"DELETE":s=yield Object(B.a)(i);break;default:s=yield Object(B.c)(i)}return JSON.parse(s||"{}")}))}networkRequest(e,t,i){return Object(p.b)(this,void 0,void 0,(function*(){return Object(q.a)(()=>Object(p.b)(this,void 0,void 0,(function*(){const i=yield this.fetchImpl(e,t);if(!i.ok)throw Error(i.statusText);return 204===i.status?[]:i.json()})),i)}))}appendQs(e,t){e.forEach(e=>{e.value&&t.searchParams.set(e.key,e.value)})}}var J=i("HDSB"),Z=i("PZnQ"),X=i("pMIE");class Y extends g.a{constructor(e,t,i,s,o,n,a){super(e,t,i,s,o,n,a),this.fetchedAllFollowedTopics=!1,this.fetchedAllRecommendedTopics=!1,this.fetchedAllTopics=!1;const c=Object(f.a)();Object(J.a)()?(this.serviceClient=new W(window.fetch.bind(window)),this.followedTopicsListKey=Object(r.b)("followedTopics")):this.serviceClient=new W(fetch),this.trackAppErrorEventCallback=R.a?e=>R.a.sendAppErrorEvent(e):null,this.useUserCreatedOrder=c.CurrentFlights.indexOf("prg-navfr-t")>-1,c.IsEnterprise&&(this.cardProvider=new O.a({initialRequest:{start:0,count:5,timeoutMs:3e3,disableFlatViewResponse:!0,select:"id"}}))}registerTrackAppErrorEventCallback(e){this.trackAppErrorEventCallback=e}followTopic(e,t){return Object(p.b)(this,void 0,void 0,(function*(){const i=b.a.isNotNullOrUndefined(yield this.getFollowedTopic(e,t));return i&&(Object(j.a)(S.a.InterestsChange),Object(T.c)(w.a.InterestsChange),Object(K.b)()||Object(L.d)()),i}))}getFollowedTopic(e,t){return Object(p.b)(this,void 0,void 0,(function*(){let i=null;return e&&(i=yield this.getTopic(e)),(!Object(F.isNullOrUndefined)(i)&&i.followState!==s.a.Followed||t)&&(e=i&&i.feedType!==l.UserQuery?e:null,t=i&&i.feedType===l.UserQuery?i.name:t,(yield this.updateTopicFollowingState(e,s.a.Followed,t))&&(i=yield this.getTopic(e),!Object(K.b)()&&(yield Object(r.g)(i,!0,this.followedTopicsListKey)))),Object(F.isNullOrUndefined)(i)||i.followState!==s.a.Followed?void 0:i}))}getFollowedTopics(e){return Object(p.b)(this,void 0,void 0,(function*(){let t=this.getCurrentState().followedTopicIds;return this.fetchedAllFollowedTopics&&!e||(e=e||(yield this.gettingTopicsAfterMigration()),(yield this.fetchFollowedTopics(e))&&(t=this.getCurrentState().followedTopicIds,e&&!Object(K.b)()&&Object(Z.d)())),t}))}getOneServiceFollowedTopics(){return Object(p.b)(this,void 0,void 0,(function*(){try{return yield this.serviceClient.getFollowedTopics(!1,this.useUserCreatedOrder)}catch(e){this.trackAppError(Object.assign(Object.assign({},h.Rc.InterestsRetrieveFollowedTopicsError),{message:"Failed fetching one service followed topics",pb:Object.assign(Object.assign({},h.Rc.InterestsRetrieveFollowedTopicsError.pb),{customMessage:"Failed fetching one service followed topics. "+(e&&e.message)})}))}}))}getRecommendedTopics(){return Object(p.b)(this,void 0,void 0,(function*(){return this.fetchedAllRecommendedTopics||(yield this.fetchRecommendedTopics()),this.getCurrentState().recommendedTopics}))}getRelatedTopics(e,t){return Object(p.b)(this,void 0,void 0,(function*(){return this.serviceClient.getRelatedTopics(e,t)}))}getNextTopicsInList(e=null){return Object(p.b)(this,void 0,void 0,(function*(){let t=this.getCurrentState().topicListMap[e];return!Object(F.isUndefined)(t)&&Object(F.isString)(t.nextPageUrl)&&(yield this.fetchTopicGroup(e))&&(t=this.getCurrentState().topicListMap[e]),t}))}getTopic(e){return Object(p.b)(this,void 0,void 0,(function*(){let t=this.getCurrentState().topicMap[e];return Object(F.isUndefined)(t)&&(yield this.fetchTopic(e))&&(t=this.getCurrentState().topicMap[e]),t}))}getTopics(e){return Object(p.b)(this,void 0,void 0,(function*(){return this.fetchedAllTopics||(yield this.fetchTopics(e)),this.getCurrentState().topicMap}))}unfollowTopic(e,t){return Object(p.b)(this,void 0,void 0,(function*(){let i=yield this.updateTopicFollowingState(e,s.a.Unfollowed,null,t);if(i&&!t){Object(j.a)(S.a.InterestsChange),Object(T.c)(w.a.InterestsChange),Object(K.b)()||Object(L.d)();const t=yield this.getTopic(e);Object(J.a)()&&!Object(K.b)()&&(i=yield Object(r.g)(t,!1,this.followedTopicsListKey))}return i}))}restoreDefaultTopics(){return Object(p.b)(this,void 0,void 0,(function*(){try{return yield this.serviceClient.restoreDefaultTopics(),Object(j.a)(S.a.InterestsChange),Object(T.c)(w.a.InterestsChange),Object(K.b)()||Object(L.d)(),yield I.b.purgeCacheAsync(I.a.followedTopics),yield this.getFollowedTopics(!0),!0}catch(e){return this.trackAppError(Object.assign(Object.assign({},h.Rc.FailedRestoringDefaultTopicsError),{message:"Failed restoring default set of followed interests",pb:Object.assign(Object.assign({},h.Rc.FailedRestoringDefaultTopicsError.pb),{customMessage:"Error: "+(e&&e.message)})})),!1}}))}fetchFollowedTopics(e){return Object(p.b)(this,void 0,void 0,(function*(){try{let t;e||!Object(J.a)()||Object(K.b)()||(yield Object(r.d)(this.followedTopicsListKey),t=yield Object(r.c)(this.followedTopicsListKey));const i=t||(yield this.serviceClient.getFollowedTopics(e,this.useUserCreatedOrder));if(Object(f.a)().IsEnterprise){const e=this.findCompanyFeedId(i);e&&(yield this.isLimitedFeed(e))&&delete i[e]}return t||(yield Object(r.f)(this.followedTopicsListKey,i,!0)),u.a.followedTopics.getActionSender(this).send(i,e),this.fetchedAllFollowedTopics=!0,!0}catch(e){return u.a.followedTopicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},h.Rc.InterestsRetrieveFollowedTopicsError),{message:"Failed fetching followed topics",pb:Object.assign(Object.assign({},h.Rc.InterestsRetrieveFollowedTopicsError.pb),{customMessage:"Failed fetching followed topics. "+(e&&e.message)})})),!1}}))}findCompanyFeedId(e){return Object.keys(e).find(t=>"CompanyFeed"===e[t].branding)}isLimitedFeed(e){return Object(p.b)(this,void 0,void 0,(function*(){try{const t=yield this.cardProvider.fetch({feedId:e});return!t.cardMetadata||t.cardMetadata.length<5}catch(e){return this.trackAppError(Object.assign(Object.assign({},h.Ve),{message:"[Enterprise] Failed to check if topic has limited data in feed",pb:Object.assign(Object.assign({},h.Ve.pb),{customMessage:e&&e.message})})),!1}}))}fetchRecommendedTopics(){return Object(p.b)(this,void 0,void 0,(function*(){try{const e=yield this.serviceClient.getRecommendedTopics();return u.a.recommendedTopics.getActionSender(this).send(Object(X.a)(e)),this.fetchedAllRecommendedTopics=!0,!0}catch(e){return u.a.recommendedTopicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},h.Rc.InterestsRetrieveRecommendedTopicsError),{message:"Failed fetching recommended topics",pb:Object.assign(Object.assign({},h.Rc.InterestsRetrieveRecommendedTopicsError.pb),{customMessage:"Failed fetching recommended topics. "+(e&&e.message)})})),!1}}))}fetchTopic(e){return Object(p.b)(this,void 0,void 0,(function*(){try{const t=yield this.serviceClient.getTopic(e),i=this.getCurrentState().topicMap[e];return(Object(F.isUndefined)(i)||i.followState!==t.followState)&&u.a.topic.getActionSender(this).send(t),!0}catch(t){return u.a.followedTopicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},h.Rc.InterestsRetrieveTopicsError),{message:"Failed to fetch topic.",pb:Object.assign(Object.assign({},h.Rc.InterestsRetrieveTopicsError.pb),{customMessage:`Failed to fetch topic ${e}. ${t&&t.message}`})})),!1}}))}fetchTopicGroup(e){return Object(p.b)(this,void 0,void 0,(function*(){if(!e)return!1;const t=this.getCurrentState().topicListMap[e],i=Object(F.isUndefined)(t)||t.nextPageUrl;if(!Object(F.isString)(i))return!1;const s=n.a.getParamsFromUrl(i);if(null===s)return!1;try{const t=yield this.serviceClient.getTopics(null,s);return u.a.topicGroup.getActionSender(this).send(t.topicGroupMap[e],t.topicMap),!0}catch(t){return u.a.topicGroupFailed.getActionSender(this).send(e),this.trackAppError(Object.assign(Object.assign({},h.Rc.InterestsRetrieveTopicsError),{message:"Failed to get topics list.",pb:Object.assign(Object.assign({},h.Rc.InterestsRetrieveTopicsError.pb),{customMessage:`Failed to get topics list ${e}. ${t&&t.message}`})})),!1}}))}fetchTopics(e){return Object(p.b)(this,void 0,void 0,(function*(){try{const t=yield this.serviceClient.getTopics(e);return u.a.topics.getActionSender(this).send(t),this.fetchedAllTopics=!0,!0}catch(e){return u.a.topicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},h.Rc.InterestsRetrieveTopicsError),{message:"Failed fetching topics.",pb:Object.assign(Object.assign({},h.Rc.InterestsRetrieveTopicsError.pb),{customMessage:"Failed fetching topics. "+(e&&e.message)})})),!1}}))}updateTopicFollowingState(e,t,i,o){return Object(p.b)(this,void 0,void 0,(function*(){try{return yield this.serviceClient.updateTopicFollowingState(e,t!==s.a.Unfollowed,i),o?!0:(yield I.b.purgeCacheAsync(I.a.followedTopics),Object(F.isNullOrUndefined)(e)&&t!==s.a.Unfollowed?this.getFollowedTopics(!0):u.a.updateTopicFollowedState.getActionSender(this).send(e,t,this.useUserCreatedOrder),!0)}catch(i){return u.a.updateTopicFollowedStateFailed.getActionSender(this).send(e,t),this.trackAppError(Object.assign(Object.assign({},t?h.Rc.InterestsFollowTopicError:h.Rc.InterestsUnfollowTopicError),{message:"Failed to update topic followed state.",pb:Object.assign(Object.assign({},t?h.Rc.InterestsFollowTopicError.pb:h.Rc.InterestsUnfollowTopicError.pb),{customMessage:`Failed to update followed state to ${t} for ${e}. ${i&&i.message}`})})),!1}}))}gettingTopicsAfterMigration(){return Object(p.b)(this,void 0,void 0,(function*(){return!(!m.a.getItem(y.a.InterestsNeedRefresh)||(yield Object(G.c)())!==v.c.SignedIn)&&(m.a.removeItem(y.a.InterestsNeedRefresh),!0)}))}trackAppError(e){this.trackAppErrorEventCallback&&this.trackAppErrorEventCallback(Object.assign(Object.assign({},e),{source:"TopicData.connector.ts"}))}}var _=i("05Au"),ee=i("Z+pL");class te{reduce(e,t){if(!e)return{followedTopicIds:[],recommendedTopics:[],topicListIds:[],topicListMap:{},topicMap:{},topicsFetchState:o.a.InProgress};if(!t)return e;let i,r=!1;return r=r||_.a.handleAction(t,u.a.followedTopics,(t,s)=>{if(!t)return;const r=Object.assign({},e.topicMap);i=Object.assign(Object.assign({},e),{topicMap:r,topicsFetchState:o.a.Loaded});const n=[];Object.keys(t).forEach(e=>{n.push(e);const i=t[e];r[e]=i}),i.followedTopicIds=s?n:Object(ee.a)(i.followedTopicIds,n),this.updateFollowState(i)}),r=r||_.a.handleAction(t,u.a.recommendedTopics,t=>{if(!t)return;const s=Object.assign({},e.topicMap);t.forEach(e=>{s[e.id]||(s[e.id]=e)}),i=Object.assign(Object.assign({},e),{recommendedTopics:t,topicMap:s,topicsFetchState:o.a.Loaded}),this.updateFollowState(i)}),r=r||_.a.handleAction(t,u.a.topic,t=>{const s=Object.assign({},e.topicMap);s[t.id]=t,i=Object.assign(Object.assign({},e),{topicMap:s,topicsFetchState:o.a.Loaded})}),r=r||_.a.handleAction(t,u.a.topics,t=>{if(!t)return;const s=Object.assign({},e.topicMap);Object.keys(t.topicMap).forEach(i=>{const o=e.topicMap[i];s[i]=Object.assign(Object.assign({},t.topicMap[i]),{isInferred:o&&o.isInferred})}),i=Object.assign(Object.assign({},e),{topicListIds:t.topicGroupIds,topicListMap:t.topicGroupMap,topicMap:s,topicsFetchState:o.a.Loaded}),this.updateFollowState(i)}),r=r||_.a.handleAction(t,u.a.topicGroup,(t,s)=>{if(!t||!t.topicIds||0===t.topicIds.length||!s)return;const r=Object.assign({},e.topicListMap),n=Object.assign({},e.topicMap),a=r[t.id];t.nextPageUrl&&(a.nextPageUrl=t.nextPageUrl),a&&a.topicIds&&(a.topicIds=Object(ee.a)(a.topicIds,t.topicIds)),t.topicIds.forEach(e=>{n[e]=s[e]}),i=Object.assign(Object.assign({},e),{topicListMap:r,topicMap:n,topicsFetchState:o.a.Loaded}),this.updateFollowState(i)}),r=r||_.a.handleAction(t,u.a.updateTopicFollowedState,(t,o,r)=>{const n=Object.assign({},e.topicMap),a=e.followedTopicIds.slice(),c=e.topicMap[t];if(o!==s.a.Unfollowed){if(Object(Q.a)(c)){const e={followState:s.a.Followed,id:t,name:""};n[t]=e}else{if(c.followState===s.a.Followed)return;n[t].followState=s.a.Followed,i=Object.assign(Object.assign({},e),{topicMap:n})}r?a.unshift(t):a.push(t)}else{if(Object(Q.a)(c))return;n[t].followState=s.a.Unfollowed;const e=a.indexOf(t);a.splice(e,1)}const d=e.recommendedTopics.map(e=>Object.assign(Object.assign({},e),{followState:e.id===t?o:e.followState}));i=Object.assign(Object.assign({},e),{followedTopicIds:a,topicMap:n,recommendedTopics:d})}),r=r||_.a.handleAction(t,u.a.recommendedTopicsFailed,()=>{i=Object.assign(Object.assign({},e),{topicsFetchState:o.a.Failed})}),r=r||_.a.handleAction(t,u.a.followedTopicsFailed,()=>{i=Object.assign(Object.assign({},e),{topicsFetchState:o.a.Failed})}),i||e}updateFollowState(e){const{followedTopicIds:t}=e;Object.keys(e.topicMap).forEach(i=>{const o=e.topicMap[i];o&&(o.followState=t.includes(i)?s.a.Followed:s.a.Unfollowed)}),e.recommendedTopics.forEach(e=>{e.followState=t.includes(e.id)?s.a.Followed:s.a.Unfollowed})}}const ie={experienceConfigSchema:{}}},CzGr:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var s=i("D57K"),o=(i("Zsg4"),i("e8jz"));function r(){return Object(s.b)(this,void 0,void 0,(function*(){const e={},t=Object(o.b)();if(t){e.MUID=t.muid;const i=yield Object(o.a)("service::api.msn.com::MBI_SSL");"MSA"===t.accountType&&i?e.UserAuthToken=i:"AAD"===t.accountType&&i&&(e.Authorization=i)}return e}))}},FRpP:function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e[e.InProgress=0]="InProgress",e[e.Loaded=1]="Loaded",e[e.Failed=2]="Failed"}(s||(s={}))},FaCY:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("G82u");class o{}o.followedTopics=new s.a("FollowedTopics"),o.followedTopicsFailed=new s.a("FollowedTopicsFailedSignature"),o.recommendedTopics=new s.a("RecommendedTopics"),o.recommendedTopicsFailed=new s.a("RecommendedTopicsFailed"),o.topic=new s.a("Topic"),o.topicFailed=new s.a("TopicsFailed"),o.topics=new s.a("Topics"),o.topicsFailed=new s.a("TopicsFailed"),o.topicGroup=new s.a("TopicGroup"),o.topicGroupFailed=new s.a("TopicGroupFailed"),o.updateTopicFollowedState=new s.a("UpdateTopicFollowedState"),o.updateTopicFollowedStateFailed=new s.a("UpdateTopicFollowedStateFailed")},LJMo:function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.Article="article",e.Slideshow="slideshow",e.Video="video",e.Spotlight="content360",e.Infopane="infopane",e.TabbedInfopane="tabbedInfopane",e.HalfPane="HalfPane",e.HeadToHead="HeadToHead",e.Mosaic="Mosaic",e.Triptych="Triptych",e.TabbedInfopaneTab="tabbedInfopaneTab",e.WebContent="webcontent",e.ExternalLink="link",e.DenseList="DenseList",e.BackFillContent="BackfillContent",e.MyBriefRiverCard="toppicks",e.NativeAd="nativead",e.TopStories="topStories",e.BingVideo="BingVideo",e.WeatherSummary="WeatherSummary",e.StockQuote="StockQuote",e.SportsMatch="SportsMatch",e.TrafficDelays="TrafficDelays",e.ShoppingMerchantCategoryDeals="ShoppingMerchantCategoryDeals",e.Group="group"}(s||(s={}))},XMd8:function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.InterestsNeedRefresh="interests-need-refresh"}(s||(s={}))},hDMs:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var s,o=i("ADRF"),r=i("rvYQ");!function(e){e.contentUrlPrefixLookup={article:"ar",video:"vi",slideshow:"ss"},e.generateTopicLink=function(e,t){const i=o.a.encodeURIComponentForPrime(t).toLowerCase(),{HostPage:s}=r.b;if(s){const t=new URL(s.originalUrl);return t.origin+"/"+s.verticalKey+"/"+s.categoryKey+"/interests/"+i+"/"+r.b.CurrentMarket+"/f-"+e+t.search}return"https://www.msn.com"},e.generateContentLink=function(t,i,s,o,n){return t&&i&&s&&o&&n?`/${r.b.CurrentMarket}/${t}/${i}/${o}/${e.contentUrlPrefixLookup[n]}-${s}`:"/"}}(s||(s={}))},hxZq:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"d",(function(){return g})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return b}));var s=i("pAXR"),o=i("k3mM"),r=i("rvYQ"),n=i("zfSW"),a=i("s9+9"),c=i("HxRh"),d=i("9J8d"),l=i("u5KZ"),u=i("l+Jz"),p=i("tWvP");const h="cbypass";function g(){const e=d.a.getInstance().rootReducer.connector(a.a.OneServiceContent);if(!e)return void(l.a&&l.a.sendAppErrorEvent(c.yd.FailedToUpdateBypassValueConnectorNotInitialized));const t=Date.now();return Object(p.a)(h,t.toString(),10/1440,r.b.HostPage.topDomain,"/"),s.a.updateCacheBypassValue.getActionSender(e).send(t),o.b.purgeCacheAsync(o.a.river).then(()=>{Object(n.c)({id:u.a.UpdateMyFeed,payload:t})})}function f(){const e=d.a.getInstance().rootReducer.connector(a.a.OneServiceContent);return e?e.getCurrentState().cacheBypassValue:0}function b(e){const t=f();t>0&&e.searchParams.set(h,t.toString())}},pAXR:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));var s=i("G82u");class o{}function r(){o.updateCacheBypassValue.unregisterObservers()}o.updateCacheBypassValue=new s.a("UpdateCacheBypassValue")},rPvf:function(e,t,i){"use strict";i.d(t,"a",(function(){return T}));var s=i("D57K"),o=i("HxRh"),r=i("tMmC"),n=i("BQg2"),a=i("rvYQ"),c=i("y+Kz"),d=i("VbA2"),l=i("msIb"),u=i("6ADy"),p=i("KETb"),h=i("hxZq");class g{constructor(){this.cachedMetadata={}}get(e){const t=f(e);if(t)return this.cachedMetadata[t]}set(e,t){const i=f(e);i&&(this.cachedMetadata[i]=t)}}function f(e){if(e)return JSON.stringify(e)}var b=i("tERu"),m=i("u5KZ"),y=i("HDSB"),v=i("/+Un"),O=i("zJcZ");class T{constructor(e){this.config=e,this.responseCache=new g,this.requestPathWithoutFeedId="MSN/Feed/me",this.requestPathWithFeedId="MSN/Feed",this.requestPathForFeedLayout="MSN/FeedLayout"}fetch(e){return Object(s.b)(this,void 0,void 0,(function*(){let t=this.config.initialRequest;if(e&&(e.feedId||!t.feedId||e.nextPageUrl||(e.feedId=t.feedId),t=Object.assign(Object.assign({},t),e)),!t)return void m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xd.RiverConfigurationIssue),{message:"default OneService fetch configuration was invalid"}));const i=this.responseCache.get(t);if(i)return i;const g={credentials:"include",headers:yield l.a.getOneServiceFeedCallHeaders(),method:"GET"},f=t.useNextPageUrl&&t.nextPageUrl,T=t.feedLayoutRequestType;let w;w=!f&&T?this.requestPathForFeedLayout:t.feedId?this.requestPathWithFeedId:this.requestPathWithoutFeedId;const j=Object(u.b)(w),S=Object(h.b)();if(f)this.requestQueryParams=new n.a(new URL(f).search),S>0&&this.requestQueryParams.set(h.a,S.toString()),a.b.SendFeedCallActivityIdInHeader||this.requestQueryParams.set(c.w.activityId,a.b.ActivityId);else{const{ocid:e,flightData:i,overwriteFlightData:s}=t,o=(yield Object(v.c)())===b.c.SignedIn?l.a.getOneServiceParamsWithAuth(a.b.UserId,e,!1,i,s):l.a.getOneServiceParamsWithoutAuth(a.b.UserId,e,!1,i,s);this.requestQueryParams=new n.a;for(let e=0;e<o.length;e++)this.requestQueryParams.set(o[e].key,o[e].value);if(T&&!t.start)this.requestQueryParams.set(c.w.feedLayoutRequestType,T);else if(!t.disableQueryType){const e=t.queryType||"myfeed";this.requestQueryParams.set(c.w.queryType,e)}if(this.requestQueryParams.set(c.w.responseSchema,t.disableFlatViewResponse?"cardview":"flatview").set(c.w.wrapOData,"false").set(c.w.disableTypeSerialization,"true").set(c.w.timeOut,""+this.getRequestTimeout(t)).set(c.w.contentType,t.contentType).set(c.w.select,t.select),t.count&&this.requestQueryParams.set(c.w.top,""+t.count),this.tryAddQueryInterestParams(t)||this.requestQueryParams.set(c.w.ids,t.feedId).set(c.w.query,t.query),!T&&!t.disableLocation){const e=l.a.getLocationParams();e&&this.requestQueryParams.set(e.key,e.value)}t.start&&this.requestQueryParams.set(c.w.skip,""+t.start),t.infopaneItemCount&&(this.requestQueryParams.set(c.w.infopaneCount,""+t.infopaneItemCount),!1===t.complexInfopaneEnabled&&this.requestQueryParams.set(c.w.complexInfoPaneEnabled,"false")),S>0&&this.requestQueryParams.set(h.a,S.toString()),(t.useDelta||t.sessionId)&&(this.requestQueryParams.set(c.w.delta,"true"),t.sessionId&&this.requestQueryParams.set(c.w.session,t.sessionId))}let I,F;a.b.SendFeedCallActivityIdInHeader&&this.requestQueryParams.delete(c.w.activityId),j.search=this.requestQueryParams.toString();try{const e=Object(y.a)()?1e4:800,t=yield Object(p.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){return yield Object(d.a)(decodeURIComponent(j.href),e,g)})),"OneServiceCardProvider.fetch");if(!t||!t.ok){const e=t?`OneService returned error response. status: ${t.status} - ${t.statusText}`:"OneService response was null";return void m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xd.OneServiceResponseWasNullOrErroneous),{message:e,pb:Object.assign(Object.assign({},o.xd.OneServiceResponseWasNullOrErroneous.pb),{customMessage:`ServiceUrl: [${j.href}]`})}))}if(I=yield t.json(),t.headers){t.headers.get("X-Statics-Fallback")&&m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xd.StaticContentLoaded),{pb:Object.assign(Object.assign({},o.xd.StaticContentLoaded.pb),{customMessage:"Request URL: "+decodeURIComponent(j.href)}),message:"Fell back to static content on the feeds call"}));const e=t.headers.get("ddd-tmpl");m.a.addOrUpdateTmplString(e),F=t.headers.get("ddd-session-id")}}catch(e){return void m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xd.ErrorFetchingOneServiceResponse),{message:"Error while fetching OneService response",pb:Object.assign(Object.assign({},o.xd.ErrorFetchingOneServiceResponse.pb),{customMessage:`Error: ${e} serviceUrl: ${j.href}, activityId: ${a.b.ActivityId}`})}))}if(!I)return void m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xd.InvalidJsonInOneServiceResponse),{message:"Didn't get valid JSON from response."}));const{nextPageUrl:C,feedItems:R}=Array.isArray(I.subCards)?Object(O.a)(I):I;if(!R)return void m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xd.InvalidFeedListInOneServiceResponse),{message:"Didn't get valid feed items list from response.",pb:Object.assign(Object.assign({},o.xd.InvalidFeedListInOneServiceResponse.pb),{customMessage:"Didn't get valid feed items list from response. JSON: "+JSON.stringify(I)})}));let k;if(R.length||t.start||(t.isSearchRequest?this.trackEmptyResponseForInterestSearch(t.feedId,t.query,j.href):t.feedId?this.trackEmptyResponseForXFeed(t.feedId,j.href):t.query?this.trackEmptyResponseForKidsMode(t.query,j.href):this.trackEmptyResponseForMyFeed(j.href)),R.length>=0?k=Object.assign(Object.assign({},t),{nextPageUrl:C,start:(t.start||0)+t.count}):r.a.log(`River has reached end of content stream. requested: ${t.count}, received: ${R.length}`),t.postRequestGrouping){const{start:e,count:i,type:s}=t.postRequestGrouping,o={type:s,subItems:R.splice(e,i)};R.splice(e,0,o)}const E={cardMetadata:R,nextPageRequest:k,sessionId:F};return this.responseCache.set(t,E),E}))}clearCache(){this.responseCache=new g}getRequestTimeout(e){const{timeoutMs:t,isSearchRequest:i,query:s,customFeedTimeoutMs:o}=e;return i&&s&&o?o:t}tryAddQueryInterestParams(e){if(!e.useVerticalAsInterest&&!e.useCategoryAsInterest)return!1;const t=(e.useVerticalAsInterest?a.b.HostPage.verticalKey:a.b.HostPage.categoryKey)||"",i=e.verticalCategoryKeyToInterestMapping[t.toLowerCase()],s=i||e.query;return this.requestQueryParams.set(c.w.query,encodeURIComponent(s)).set(c.w.source,e.contentSource),!!(i||e.useCategoryAsInterest&&!t)||(m.a.sendAppErrorEvent(Object.assign(Object.assign({},o.xd.QueryInterestContentFetchError),{message:"Failed to get content",pb:Object.assign(Object.assign({},o.xd.QueryInterestContentFetchError.pb),{customMessage:`Failed to get content for VerticalKey:${a.b.HostPage.verticalKey} | CategoryKey:${a.b.HostPage.categoryKey}. Loading fallback views river with ${s} content.`})})),!1)}trackAppErrorHelper(e,t,i,s,o){let r="";s&&(r+=`Feed id: ${s}. `),o&&(r+=`Feed query: ${o}. `),r+="href: "+i,m.a.sendAppErrorEvent(Object.assign(Object.assign({},e),{message:t,pb:Object.assign(Object.assign({},e.pb),{customMessage:r})}))}trackEmptyResponseForKidsMode(e,t){this.trackAppErrorHelper(o.wb,"OneService returned an empty feed for kids mode",t,null,e)}trackEmptyResponseForXFeed(e,t){this.trackAppErrorHelper(o.vb,"OneService returned an empty feed for an x-feed page.",t,e,null)}trackEmptyResponseForInterestSearch(e,t,i){e?this.trackAppErrorHelper(o.xb,"OneService returned an empty feed for a user searched xfeed.",i,e,null):this.trackAppErrorHelper(o.yb,"OneService returned an empty feed for a user query.",i,null,t)}trackEmptyResponseForMyFeed(e){this.trackAppErrorHelper(o.xd.EmptyMyFeed,"OneService returned an empty feed for a myfeed request.",e,null,null)}}T.providerName="OneService"},"uH2+":function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.Followed="followed",e.Unfollowed="unfollowed",e.Locked="locked",e.None="none"}(s||(s={}))},zJcZ:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("LJMo");function o(e){return e?{feedItems:e.subCards.map(e=>r(e)),nextPageUrl:e.nextPageUrl}:{}}function r(e){if(!e)return{};if(e.type===s.a.SportsMatch||e.type===s.a.StockQuote||e.type===s.a.TrafficDelays||e.type===s.a.WeatherSummary||e.type===s.a.ShoppingMerchantCategoryDeals)return e;if(e.subCards)return e.type==s.a.MyBriefRiverCard||e.type==s.a.TopStories?e:function(e){const{type:t,title:i}=e,s=e.subCards.map(e=>r(e));return{type:t,subItems:s,metadata:{title:i}}}(e);if(e.type===s.a.ExternalLink)return function(e){const{id:t,type:i,images:s,url:o,category:r,feed:n={},title:a="",abstract:l=""}=e,u=d(s)||{},p=c(o),{uiHint:h,actionText:g}=e.uiMetadata||{};return{id:t,type:i,metadata:{abstractLength:l.length,title:a,titleLength:a.length,category:r||p[4],subCategory:"other",primaryImage:{height:u.height,width:u.width,url:u.url},locale:p[3],url:o,abstract:l,uiHint:h,actionText:g,feed:{id:n.id},kicker:[{feedName:n.feedName}]}}}(e);if(e.type===s.a.WebContent)return function(e){const{id:t,type:i,images:s,url:o,category:r,locale:n,reactionSummary:a,commentSummary:u,abstract:p="",feed:h={},title:g="",provider:f={},actions:b=[]}=e,m=d(s)||{},y=c(o);return{id:t,type:i,metadata:{abstract:p,abstractLength:p.length,titleLength:g.length,category:r||y[4],subCategory:y[5],locale:n,feed:{id:h.id},kicker:[h],actions:b.map(e=>l[e]||e),reactionSummary:a,commentSummary:u,primaryImage:{height:m.height,width:m.width,url:m.url},url:o,title:g,provider:{name:f.name,logo:{url:f.logoUrl}}}}}(e);const{type:t,isBreaking:i,locale:o,category:u,images:p,topics:h=[],dataUrl:g,publishedDateTime:f,id:b,url:m,abstract:y="",title:v="",provider:O={},feed:T={},actions:w=[],externalVideoFiles:j,reactionSummary:S,commentSummary:I,sourceId:F}=e,C=d(p)||{},R=j||{},k=h.find(e=>e.feedId===T.id&&e.locale===o),E=c(m);let A=a(O.logoUrl);return!A&&O.logo&&O.logo.url&&(A=a(O.logo.url)),{id:b,type:t,metadata:{abstractLength:y.length,titleLength:v.length,category:u||E[4],subCategory:E[5],primaryImage:{height:C.height,width:C.width},locale:o,feed:{id:T.id},kicker:[T],actions:w.map(e=>l[e]||e),reactionSummary:S,commentSummary:I},cardContent:{id:b,type:n(t),title:v,uriTitle:E[6],abstract:y,isBreaking:i||0,tags:[k||{}],provider:{id:O.id,name:O.name,logo:{id:A},logoUrl:O.logoUrl,subscribable:!1},category:{product:u,label:void 0},locale:o,images:[{id:a(C.url),height:C.height,width:C.width,caption:C.title,focalRegion:C.focalRegion,attribution:C.attribution,url:C.url}],videoFiles:R,publishedDateTime:f,kicker:v,sourceHref:g,destinationUrl:m,sourceId:F}}}function n(e){switch(e){case"article":return"ArticlePreview";case"video":return"VideoPreview";case"slideshow":return"SlideshowPreview";default:return""}}function a(e){if(!e)return"";const t=e.split("/");return d(t)&&t[t.length-1].replace(".img","")}function c(e){return e?e.split("/"):[]}function d(e=[],t=0){return e[t]}const l={liked:"like",unliked:"unlike",saved:"save"}}}]);